<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>計算概要</title>
</head>

<body>
    <div class="container">
        <div style="border-bottom: 1px solid #aaa;">
            <h1 style="text-align: center;font-weight:bold;">架空鉄道向け所要時間計算機における計算の概要</h1>
        </div>
        <p>このページは当機内部でどのような計算が行われているか説明するページです。ソースコードだけだと分かりずらいし文字起こししておこうということです。</p>
        <p><span style="font-size: 150%;font-weight: bold;">御託はいいからとっととツール出せ！！！</span>という方は下記リンクをクリックしてください。</p>
        <a href="index.html">架空鉄道向け所要時間計算機/ダウンロード不要/完全無料/広告なし/2025年最新版</a></p>
        <h2>0.当機の主な特徴</h2>
        <p>はっきりいってこれを書きたいがためにこのページ作ったまであります、こんなことできるんだぞどうだすごいだろ！！と...</p>
        <p>1.リアルタイムで計算結果が出てきます
            <span class="small">これのおかげでめっちゃ楽になった。</span>
        </p>
        <p>2.見た目が非常に私好みです
            <span class="small">上にカーソル合わせると文字の大きさとか色が変わる部分とかめっちゃよくね？</span>
        </p>
        <p>3.最高速度まで加速しきれないときとか勝手に加速可能な速度を求めてそれで計算してくれます
            <span class="small">これあるとないじゃだいぶ手間が変わってきますな。</span>
        </p>
        <p>4.エラーのときはちゃんと大体の原因を示してくれます
            <span class="small">クッソ分かりやすくていいよね。</span>
        </p>
        <p>5.勾配とか空走時間とかも考慮に入れた計算ができます
            <span class="small">なかなかレアな機能なのでは。</span>
        </p>
        <p>6.初速度終速度を0以外にも設定できるので区間の途中で制限速度が変わるとことかもいけます
            <span class="small">優等種別にも応用できるぞ！</span>
        </p>
        <h2>1.あらまし</h2>
        <p>
            まず、電車は加速して惰行して減速するのでそれぞれに対し時間を求めて合体しようといったところだ。
            だがこのままだと区間が短すぎて最高速度までそもそも加速できなかったり、初速度から止まるための距離がそもそも足りなかったりと色々不都合が出てくる。
            このままではいけないので最高速度を自動的に到達可能な速度に切り下げたり、止まれない場合にエラーメッセージを搭載する分岐を作らなければならない。めんどくさ。
        </p>
        <p>
            ここでは、白字で計算式自体についての説明、<span class="bunki">黄字でプログラム的な分岐等についての説明をする。</span>
        </p>
        <h2>2.根幹となる式(Ver1系列)</h2>
        <p>とりあえずバージョンを追って説明していく。はからずとも絶対そっちのがわかりやすくなっていたので。</p>
        <p>また、この文章では特に注のない限り長さの単位をメートル、時間の単位を秒、勾配の単位をパーミルとして全ての式を組み立て、減速度は正の数で入力されるものとする。</p>
        <h3>2.1.高校物理の式</h3>
        <p>こういう話をするとき、高校物理を通ってきた人間なら真っ先に思い浮かぶ式があるだろう。</p>
        <img src="img/1.png">
        <p>てか私もそうだった、ちょうど架空鉄道がちょっとしたマイブームになってた時にこの式習ったもんだから(因みに当時作ってた<a
                href="https://sites.google.com/view/nagasaki-kaihin/%E3%83%80%E3%82%A4%E3%83%A4%E6%99%82%E5%88%BB%E8%A1%A8">長崎海浜鉄道</a>という架空鉄道にもこのツールのVer2.1時点での説明みたいのが途中までされてたりする)。
        </p>
        <p>では(2.1.1)式を変形すると...</p>
        <img src="img/2.png">
        <p>
            速攻解決した、最高かよ...となりそうだがそうはいかない。ここで最終的な所要時間についての式を立ててみよう。
        </p>
        <img src="img/4.png">
        <p>tsは最終的に求まる所要時間だ。vh~agも車両や路線のデータを入力すればいい。あれ？x惰行(惰行距離)はどうしよう...</p>
        <h3>2.2.惰行運転する距離</h3>
        <p>そろそろ文に区切りをつけたかったので見出しをたてたが、惰行距離を求めることはすぐできる。単純に駅間距離から加速にかかった距離と減速にかかった距離を引いてやればいいのだ。ここで、(2.1.2)式を使いたくなりそうだがこの式で距離を求めるなら時間tが必要だ。しかしこの時間tこそ私たちが分からないので求めようとしている値であるためにこの式は利用しない。
        </p>
        <p>ここで、(2.1.3)式を変形してみよう。</p>
        <img src="img/5.png">
        <p>よって、</p>
        <img src="img/6.png">
        <p>できた。これで完璧なように思えるが、そうはいかない。そしてここに当機の目玉となるある機能が搭載されるに至った所以が存在するのだ。</p>
        <div class="bunki">
            <h3>2.3.最高速度自動切り下げシステム</h3>
            <p>もう字面からして最高の機能に違いない。なんせしょっぱなに"最高"とかついている。いやホントに便利な機能なのである、まじで。</p>
            <p>さて、今までで組んだ式をv-xグラフにするとこんな感じになる。</p>
            <img src="img/7.png">
            <p>さて、このようにユーザーが入力した最高速度まで加速、そっから惰行、減速までできればいいのだが...ここで駅間距離を少しづつ縮めてみよう。</p>
            <img src="img/8.png">
            <p>最低だ。駅間距離が短すぎて入力した最高速度まで加速できない。駅間が短くなると最高速度にも限界値ができるのだ。この状況でエラーを吐くようにプログラムする手もあるのだが、それだと限界値を自分で目星付けるなどして入力しなおすのを繰り返さなければならない。でも私はそんなことやりたくない、めんどすぎる。なのでこの状況に至った時に最高速度を0.01m/sずつ切り下げるプログラムを組むこととした。
            </p>
            <img src="img/9.png">
            <p>分かりやすいようにフローチャートとやらにしてみた、なんかいい感じ。知らんけど。</p>
            <p>しかし、このプログラムにも欠点がある。余りにも大きい値(10000km/hとか)を最高速度に入力されると切り下げの計算が終わらず処理が長期化、フリーズする場合がある。なのでくれぐれも最高速度は常識的な値を入力するようお願いしたい...
            </p>
            <h3>2.4.切り下げすぎてしまう(ver1.2)</h3>
            <p>さて、このように利便性のすごい高い自動切り下げ機能だが、使っているうちにどうも切り下げすぎてしまうらしいということを発見した。便利さゆえの悩みである、ああ贅沢...</p>
            <img src="img/10.png">
            <p>図2.4.1、3番目のグラフのようになったときにどうなるかを考えてみよう。このまま計算した場合、(2.2.2)式に従えば、減速距離が負となってしまうのである。これはいけないのでエラーメッセージを表示するようにした。
            </p>
            <p>ここで思った方もいるだろう。終速度(と初速度)にも自動切り下げシステムを導入すればいいのではないかと。そのとおりである。しかしこの当時は思いつかなかったのかまだ実装されていないのである。多分そのうち作る。(2025.5.30現在)
            </p>
            <p>あともう一つ、このシステムでは0.01m/sずつ切り下げているがゆえに、厳密にいうと"真の限界速度からわずかに小さい値"を最高速度と近似しているということになる。つまり</p>
            <img src="img/11.png">
            <p>このように真の値と最終速度の差がとても小さい場合に最終速度まで加速可能にもかかわらず切り下げすぎとなりエラーとなってしまう場合がある。これを防ぐためにエラー判定をするまえに最高速度=最終速度とした場合の加減速距離を計算するようなプログラムを組んだ。
            </p>
            <h3>2.5その他エラー</h3>
            <p>初速度や終速度にそもそも最高速度より大きい値が入力された場合もエラーメッセージが出るようにした。</p>
        </div>
        <h3>2.6 根幹となる式の結論</h3>
        <img src="img/4.png">
        <div></div>
        <img src="img/6.png">
        <p>この二つの式と最高速度自動切り下げシステム、各種エラーログで動作するバージョンであった。</p>
        <h2>3.勾配を考慮した式(ver2系列)</h2>
        <p>さて、基幹となる式とプログラム的な分岐は組むことができた。ここで次に考慮すべき事項は</p>
        <p>1.勾配による影響</p>
        <p>2.車両諸元にしばしば示されている起動加速度は速度が上昇した場合実際の加速度と乖離する点</p>
        <p>この章では1番について解決するものとする。2番に関しては等加速度運動から外れてしまうため、当時高校生だった制作者には解決することができなかった。</p>
        <h3>3.1.勾配がある場合の減速にかかる距離の式</h3>
        <p>過去に制作していた架空鉄道にて、下り勾配に制限速度かかかる理由を調査していた一環で勾配がある場合の減速にかかる距離の式を発見した。発見の経緯などは<a href="https://sites.google.com/view/nagasaki-kaihin/%E3%83%80%E3%82%A4%E3%83%A4%E6%99%82%E5%88%BB%E8%A1%A8">長崎海浜鉄道</a>に記載されている。
        </p>
        <div style="background-color: #333;">
            <p>『鉄道電気技術者のための信号概論　閉そく装置』(日本鉄道電気技術協会、2008年4月)が引用されている『電車はブレーキをかけてから何mで停止できる？新幹線は？列車脱線事故の京浜急行電鉄は？』https://www.excite.co.jp/news/article/Bizjournal_202001_post_134461/
                (梅原淳、2020年1月)によると、</p>
            <p>　S＝V1の二乗-V2の二乗÷7.2×（β+θ÷K）+t×V1÷3.6　[m]</p>
            <p>　　V1は初速度（km/h）、V2は終速度（km/h）、tは空走時間（秒）、βは減速度（km/h/s）、θは勾配（パーミル）、Kは係数で電車による列車は31、機関車に牽引される客車による列車は30。</p>
        </div>
        <p>これを当機で使用する変数に置き換え整理すると、</p>
        <img src="img/12.png">
        <p>ここで、(2.2.2)式のxgと見比べてみると、勾配によって減速しやすくなるため減速度に+s/3.6kが、距離全体に+vhfr(空走距離)がされているだけで、基本的には同様の形を保っていることがわかる。逆に加速について考えてみると、勾配によって加速しづらくなるため加速度に-s/3.6kがされ、ブレーキによる要素である空走距離は考慮しなくてよいため、</p>
        <img src="img/13.png">
        <p>となると考えられ、それぞれ(2.1.5)式と(2.2.2)式のak,agを置き換えることにより勾配と空走時間を含めた計算ができると考えられる。</p>
        <p>ちなみに、当機では(速度^2の差分)/(空走時間も含めた加減速距離)から求める実質加減速度という指標を導入し、計算を簡便化している。</p>

        <div class="bunki">
            <h3>3.2.急すぎる勾配により加速減速ができない場合</h3>
            <p>(3.1.1)式及び(3.2.2)式に従う場合、登り勾配において加速できない場合や下り勾配において減速できない場合が生じる。登り勾配の時はak-s/3.6kが、下り勾配の時はag+s/3.6kがそれぞれ0以下の場合に加減速ができないことがわかる。それぞれの場合においてエラーメッセージを表示する必要がある。</p>
            <h3>3.3.減速しない場合</h3>
            <p>(3.1.1)式に従う場合、減速しない場合でも減速にかかる距離が存在してしまう。そのため、vh=vfのときはxg=0とする処理を各段階に加えるべきである。</p>        </div>
        <h2>4.加速度が一定でないことを考慮した式(現在検討中)</h2>
    </div>
    <style>
        body {
            color: #fff;
            background-color: rgb(0, 0, 0);
            font-family: sans-serif;
            padding-left: 10%;
            padding-right: 10%;
            padding-top: 10px;
            padding-bottom: 10px;
        }

        a {
            color: #0ff;
        }

        .small {
            font-size: 70%;
        }

        .bunki {
            color: rgb(255, 245, 153);
        }

        h2:hover {
            color: rgb(255, 103, 103);
        }

        h3:hover {
            color: rgb(255, 103, 103);
        }

        a:hover {
            color: #0ff;
        }
    </style>

</body>

</html>
